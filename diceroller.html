<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- Base Layout & Element Styling --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            -webkit-user-select: none;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            touch-action: manipulation;
        }
        #app-container {
            max-width: 450px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            display: flex; 
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
        }
        
        /* Dice interaction styles */
        .dice-container {
            width: 100%;
            aspect-ratio: 1 / 1; 
            transition: transform 0.1s ease-out;
            cursor: pointer;
            line-height: 1; 
            position: relative;
        }
        .dice-container:active {
            transform: scale(0.95);
        }
        
        /* Button feedback and styling */
        .die-type-button {
            transition: all 0.2s ease-in-out; 
            margin: 2px 0; 
        }
        .die-type-button:active {
            transform: none !important; 
            filter: brightness(0.85); 
        }

        /* Reroll/Clear Icons */
        #reroll-icon, #clear-icon {
            height: 40px; 
            width: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.15);
            transition: all 0.15s ease;
        }
        #reroll-icon:active, #clear-icon:active {
            transform: scale(0.9);
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* --- DARK MODE STYLES --- */
        
        /* Smooth transitions for elements that change color */
        #app-container, #info-box, .dice-container {
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
        }

        .dark body {
            background-color: #111827; 
        }
        .dark #app-container {
            background-color: #1f2937; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        .dark #info-box {
            background-color: #374151; 
        }
        .dark #die-type-buttons {
            background-color: #1f2937; 
        }
        .theme-mode-btn, .die-type-button {
            font-size: 16px !important; 
        }
        #empty-tray-message {
            color: #6b7280; 
        }
        .dark #empty-tray-message {
            color: #ffffff; 
        }
        
    </style>
</head>
<body>

<div id="app-container">
    
    <div class="flex gap-3 w-full mb-8 h-96"> 
        
        <!-- DICE GRID: Container for dice or the empty-state message/toggle -->
        <div id="dice-grid" class="grid grid-cols-3 grid-rows-4 gap-2 flex-grow max-w-[75%] h-full">
            <!-- Content generated by JS renderUI() -->
        </div>

        <!-- INFO BOX / STATS PANEL -->
        <div id="info-box" class="flex flex-col justify-between items-center pt-4 px-3 pb-8 bg-gray-700 rounded-xl shadow-lg w-1/4 min-w-[100px] max-w-[100px] h-full">
            
            <div class="flex flex-col gap-1 w-full mb-6">
                <!-- Stats display -->
                <div id="total-stat" class="text-center text-white pb-1 border-b border-gray-600">
                    <p class="text-xs font-semibold opacity-80 leading-tight">TOTAL</p>
                    <span id="total-score" class="text-3xl font-black transition duration-150 ease-in-out">0</span>
                </div>
                <div id="count-stat" class="text-center text-white">
                    <p class="text-xs font-semibold opacity-80 leading-tight">COUNT</p>
                    <span id="count-score" class="text-xl font-bold">0</span>
                </div>
                <div id="min-stat" class="text-center text-white">
                    <p class="text-xs font-semibold opacity-80 leading-tight">MIN</p>
                    <span id="min-score" class="text-xl font-bold">0</span>
                </div>
                <div id="max-stat" class="text-center text-white">
                    <p class="text-xs font-semibold opacity-80 leading-tight">MAX</p>
                    <span id="max-score" class="text-xl font-bold">0</span>
                </div>
                <div id="avg-stat" class="text-center text-white">
                    <p class="text-xs font-semibold opacity-80 leading-tight">AVG</p>
                    <span id="avg-score" class="text-xl font-bold">0.00</span>
                </div>
            </div>

            <!-- Action Icons -->
            <div class="flex flex-col gap-2"> 
                <button id="reroll-icon" class="text-white">
                    <i class="fas fa-redo-alt text-xl"></i>
                </button>
                <button id="clear-icon" class="text-white">
                    <i class="fas fa-trash-alt text-xl"></i>
                </button>
            </div>
            
        </div>
    </div>
    
    <!-- Die Type Selection Buttons Container -->
    <div class="w-full mb-0">
        <div id="die-type-buttons" class="flex justify-between gap-1 p-1 bg-white dark:bg-gray-900 rounded-xl">
            <!-- Buttons generated by JS createDieTypeButtons() -->
        </div>
    </div>
    
</div>

<!-- TEMPLATE FOR THEME TOGGLE (Injected into dice-grid when empty) -->
<div id="theme-toggle-template" class="hidden">
    <div class="flex flex-col items-center h-full w-full"> 
        
        <!-- Theme Switch -->
        <div class="flex-shrink-0 w-full flex justify-center pt-4 pb-12">
            <div class="inline-flex rounded-full bg-gray-200 dark:bg-gray-700 p-0.5 shadow-md">
                <button data-mode="light" class="theme-mode-btn px-3 py-1 text-xs sm:text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-600 transition duration-150">
                    <i class="fas fa-sun"></i> Light
                </button>
                <button data-mode="dark" class="theme-mode-btn px-3 py-1 text-xs sm:text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-600 transition duration-150">
                    <i class="fas fa-moon"></i> Dark
                </button>
                <button data-mode="auto" class="theme-mode-btn px-3 py-1 text-xs sm:text-sm font-medium rounded-full text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-600 transition duration-150">
                    <i class="fas fa-desktop"></i> Auto
                </button>
            </div>
        </div>
        
        <!-- Welcome Message -->
        <div class="flex-grow flex items-center justify-center">
            <p id="empty-tray-message" class="text-center text-lg sm:text-xl">
            </p>
        </div>
        
        <!-- Spacer for centering -->
        <div class="h-12 flex-shrink-0"></div> 
        
    </div>
</div>
<!-- END TEMPLATE -->

<script>
    // --- Configuration and State ---
    const maxDice = 12;
    const availableDieTypes = [4, 6, 8, 10, 12, 20]; 
    let rolledDice = [];
    let currentDieTypeSelection = null; 
    
    // SVG properties for each die type
    const polyhedralSVGs = {
        4: { viewBox: "0 0 100 100", path: "M 50,5 L 95,90 L 5,90 Z", numberX: 50, numberY: 55, color: '#4c9f4e' }, // Green
        6: { viewBox: "0 0 100 100", path: "M 10 10 L 90 10 L 90 90 L 10 90 Z", numberX: 50, numberY: 50, color: '#59bed0' }, // Teal
        8: { viewBox: "0 0 100 100", path: "M 50 0 L 100 50 L 50 100 L 0 50 Z", numberX: 50, numberY: 47, color: '#8243cd' }, // Purple
        10: { viewBox: "0 0 100 100", path: "M 50 0 L 95 35 L 95 65 L 50 100 L 5 65 L 5 35 Z", numberX: 50, numberY: 50, color: '#d14193' }, // Pink
        12: { viewBox: "0 0 100 100", path: "M 50 0 L 80 15 L 95 40 L 95 60 L 80 85 L 50 100 L 20 85 L 5 60 L 5 40 L 20 15 Z", numberX: 50, numberY: 47, color: '#ca4947' }, // Red
        20: { viewBox: "0 0 100 100", path: "M 50 0 L 90 30 L 90 70 L 50 100 L 10 70 L 10 30 Z", numberX: 50, numberY: 50, color: '#e58531' } // Orange
    };
    
    const welcomeMessages = [
        "Adventure is out there!",
        "Choose wisely.",
        "Dark and difficult times lie ahead.",
        "Don't get cocky, kid.",
        "Fate, it seems, is not without irony.",
        "Fortune and glory, kid. Fortune and glory.",
        "Game over, man! Game over!",
        "Have fun storming the castle!",
        "I can do this all day.",
        "I have a bad feeling about this.",
        "I'm your huckleberry.",
        "It's a moral imperative!",
        "It's dangerous to go alone!",
        "Let's go exploring!",
        "Never tell me the odds.",
        "This whole ship is a treasure.",
        "We came, we saw, we kicked its ass!",
        "What is your quest?",
        "Would you kindly...",
        "You have my sword.",
    ];

    // DOM Element References
    const diceGrid = document.getElementById('dice-grid');
    const totalScoreElement = document.getElementById('total-score');
    const countScoreElement = document.getElementById('count-score'); 
    const minScoreElement = document.getElementById('min-score');
    const maxScoreElement = document.getElementById('max-score');
    const avgScoreElement = document.getElementById('avg-score');
    const dieTypeButtonsContainer = document.getElementById('die-type-buttons');
    const rerollIcon = document.getElementById('reroll-icon');
    const clearIcon = document.getElementById('clear-icon');

    // --- Utility Functions ---

    function IntRandom(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getEmptyTrayMessage() {
        const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
        return welcomeMessages[randomIndex];
    }

    function alertMessage(message) {
        // Use console log for alerts, as window.alert is blocked in the environment
        console.log("ALERT:", message); 
    }

    // --- Rendering and UI Management ---

    function createPolyhedralSVG(type, value) {
        const svgData = polyhedralSVGs[type];
        const baseColor = svgData.color;
        const contrastColor = '#fff'; 
        
        return `
            <svg class="dice-svg" viewBox="${svgData.viewBox}" xmlns="http://www.w3.org/2000/svg">
                <path d="${svgData.path}" fill="${baseColor}" stroke="transparent" stroke-width="0"/>
                
                <text x="${svgData.numberX}" y="${svgData.numberY}" 
                      fill="${contrastColor}" 
                      text-anchor="middle" 
                      dominant-baseline="middle"
                      style="font-family: 'Inter', sans-serif; font-size: 30px; font-weight: 700; pointer-events: none;">
                    ${value}
                </text>
                
                <text x="50" y="75" 
                      fill="${contrastColor}" 
                      text-anchor="middle" 
                      dominant-baseline="middle"
                      opacity="0.7"
                      style="font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; pointer-events: none;">
                    D${type}
                </text>
            </svg>
        `;
    }

    function createDiceFace(dieObject, index) {
        const container = document.createElement('div');
        container.className = "dice-container w-full"; 
        container.innerHTML = createPolyhedralSVG(dieObject.type, dieObject.result);
        
        // Add click listener for die removal
        container.addEventListener('click', (e) => {
            e.stopPropagation(); 
            removeDie(index);
        });
        
        return container;
    }

    function createDieTypeButtons() {
        dieTypeButtonsContainer.innerHTML = '';
        availableDieTypes.forEach((type) => {
            const button = document.createElement('button');
            button.textContent = `D${type}`;
            button.dataset.dieType = type;
            
            const dieColor = polyhedralSVGs[type].color;
            button.style.backgroundColor = dieColor;
            button.style.borderColor = dieColor; 
            
            button.className = 'die-type-button flex-1 px-1 py-1.5 text-sm md:text-base font-semibold rounded-full border-4 transition text-white shadow-md hover:opacity-90 whitespace-nowrap opacity-75';
            
            button.addEventListener('click', handleDieTypeSelection);
            dieTypeButtonsContainer.appendChild(button);
        });
    }
    
    // Core function to update the entire display state
    function renderUI() {
        diceGrid.innerHTML = ''; 
        
        if (rolledDice.length === 0) {
            // Empty Tray State: Show Theme Toggle and Welcome Message
            const toggleTemplate = document.getElementById('theme-toggle-template');
            
            const wrapper = document.createElement('div');
            wrapper.className = 'col-span-3 h-full w-full'; 
            wrapper.innerHTML = toggleTemplate.innerHTML;
            
            wrapper.querySelector('#empty-tray-message').textContent = getEmptyTrayMessage();
            diceGrid.appendChild(wrapper);

            attachThemeToggleListeners(); 

            // Reset stats
            totalScoreElement.textContent = 0;
            countScoreElement.textContent = 0;
            minScoreElement.textContent = 0;
            maxScoreElement.textContent = 0;
            avgScoreElement.textContent = '0.00';

            // Disable action buttons
            rerollIcon.disabled = clearIcon.disabled = true;
            rerollIcon.classList.add('opacity-50', 'cursor-not-allowed');
            clearIcon.classList.add('opacity-50', 'cursor-not-allowed'); 
            
            currentDieTypeSelection = null; 
        } else {
            // Dice Rolled State: Show Dice and Stats
            rerollIcon.disabled = clearIcon.disabled = false;
            rerollIcon.classList.remove('opacity-50', 'cursor-not-allowed');
            clearIcon.classList.remove('opacity-50', 'cursor-not-allowed'); 
            
            let total = 0;
            const results = [];

            // Render dice and accumulate results
            rolledDice.forEach((die, index) => {
                diceGrid.appendChild(createDiceFace(die, index));
                total += die.result;
                results.push(die.result);
            });
            
            // Update stats display
            const count = rolledDice.length;
            const min = Math.min(...results);
            const max = Math.max(...results);
            const avg = total / count;

            totalScoreElement.textContent = total;
            countScoreElement.textContent = count;
            minScoreElement.textContent = min; 
            maxScoreElement.textContent = max; 
            avgScoreElement.textContent = avg.toFixed(2); 
        }

        // Highlight the selected die type button
        dieTypeButtonsContainer.querySelectorAll('.die-type-button').forEach(button => {
            const buttonType = parseInt(button.dataset.dieType);
            const dieColor = polyhedralSVGs[buttonType].color;
            
            if (buttonType === currentDieTypeSelection) {
                button.classList.add('shadow-xl');
                button.classList.remove('opacity-75'); 
            } else {
                button.style.borderColor = dieColor; 
                button.classList.remove('shadow-xl');
                button.classList.add('opacity-75');
            }
        });
        
        if (navigator.vibrate) {
            navigator.vibrate(50); 
        }
    }

    // --- Die Action Handlers ---

    function rollDice() {
        if (rolledDice.length === 0) return;
        
        rolledDice = rolledDice.map(die => ({
            type: die.type,
            result: IntRandom(1, die.type)
        }));
        
        renderUI();
    }

    function handleDieTypeSelection(event) {
        const newDieType = parseInt(event.currentTarget.dataset.dieType, 10);
        currentDieTypeSelection = newDieType; 
        
        if (rolledDice.length < maxDice) {
            rolledDice.push({
                type: newDieType,
                result: IntRandom(1, newDieType)
            });
            renderUI(); 
        } else {
            alertMessage(`Maximum of ${maxDice} dice reached!`);
        }
    }

    function removeDie(index) {
        if (rolledDice.length > 0) {
            rolledDice.splice(index, 1);
            renderUI();
        }
    }
    
    function clearDice() {
        if (rolledDice.length > 0) {
            rolledDice = [];
            renderUI(); 
        }
    }
    
    // --- Dark Mode / Theme Management ---
    
    function setTheme(mode) {
        const html = document.documentElement;
        try {
            localStorage.setItem('theme', mode);
        } catch (e) {
            console.error("Local storage error:", e);
        }
        
        updateToggleVisuals(mode);

        if (mode === 'dark') {
            html.classList.add('dark');
        } else if (mode === 'light') {
            html.classList.remove('dark');
        } else { // mode === 'auto'
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
        }
    }

    function updateToggleVisuals(currentMode) {
        document.querySelectorAll('.theme-mode-btn').forEach(button => {
            if (button.dataset.mode === currentMode) {
                // Active style
                button.classList.add('bg-white', 'dark:bg-gray-600', 'text-blue-600', 'dark:text-blue-400', 'shadow-md');
                button.classList.remove('hover:bg-white', 'dark:hover:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
            } else {
                // Inactive style
                button.classList.remove('bg-white', 'dark:bg-gray-600', 'text-blue-600', 'dark:text-blue-400', 'shadow-md');
                button.classList.add('hover:bg-white', 'dark:hover:bg-gray-600', 'text-gray-700', 'dark:text-gray-300');
            }
        });
    }

    function attachThemeToggleListeners() {
        const themeToggleButtons = diceGrid.querySelectorAll('.theme-mode-btn');
        themeToggleButtons.forEach(button => {
            button.removeEventListener('click', handleThemeToggleClick); 
            button.addEventListener('click', handleThemeToggleClick);
        });
        
        // Set initial visual state
        const storedTheme = localStorage.getItem('theme') || 'auto'; 
        updateToggleVisuals(storedTheme);
    }
    
    function handleThemeToggleClick(e) {
        setTheme(e.currentTarget.dataset.mode);
    }

    // --- App Initialization ---

    function initializeApp() {
        // 1. Load and apply saved theme setting
        let storedTheme = 'auto'; // Initialize default
        try {
            // If a theme is stored, use it. Otherwise, use the 'auto' default.
            storedTheme = localStorage.getItem('theme') || 'auto';
        } catch (e) {
            console.warn("Could not read theme from local storage, defaulting to 'auto'.", e);
        }
        setTheme(storedTheme); 

        // 2. Listen for system theme changes if mode is 'auto'
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if (localStorage.getItem('theme') === 'auto') {
                setTheme('auto');
            }
        });

        // 3. Setup action buttons
        createDieTypeButtons();
        rerollIcon.addEventListener('click', rollDice);
        clearIcon.addEventListener('click', clearDice);
        
        // 4. Render initial state (empty tray)
        rolledDice = [];
        renderUI(); 
    }

    // Start the app
    initializeApp();
</script>

</body>
</html>
